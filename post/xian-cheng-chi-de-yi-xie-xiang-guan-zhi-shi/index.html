<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>çº¿ç¨‹æ± çš„ä¸€äº›ç›¸å…³çŸ¥è¯† | Gridea</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://tangyin1.github.io/favicon.ico?v=1741659499653">
<link rel="stylesheet" href="https://tangyin1.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="ğŸ˜€ğŸ˜€ğŸ˜€æœ€è¿‘åœ¨bç«™ä¸Šåˆ·åˆ°ä¸€ä¸ªå…³äºçº¿ç¨‹æ± çš„è¯¾ç¨‹ï¼Œä»¥å‰å­¦osçš„æ—¶å€™ä¹Ÿæ²¡è®¤çœŸå­¦ä¹ ç›¸å…³ä»£ç çŸ¥è¯†ï¼Œåªæ˜¯äº†è§£ä¸€ä¸‹ç†è®ºçŸ¥è¯†ï¼ŒçŸ¥é“ä¸€äº›é˜»å¡ï¼Œç«äº‰ï¼Œæ—¶é—´ç‰‡è½®è½¬ç­‰ç­‰ä¸€äº›ï¼Œä»¥ä¸‹æ˜¯ç›¸å…³è§†é¢‘ä¸‹é¢è®°å¾—ç¬”è®°ã€‚
ï¼ˆä¸è¿‡å­˜åœ¨ä¸€äº›é—®é¢˜è¿˜æ²¡æœ‰è§£å†³ï¼Œåœ¨æ‰‹å†™ä¸€ä¸ªçº¿ç¨‹æ± çš„é‚£é‡Œï¼Œæ²¡..." />
    <meta name="keywords" content="" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://tangyin1.github.io">
        <img src="https://tangyin1.github.io/images/avatar.png?v=1741659499653" class="site-logo">
        <h1 class="site-title">Gridea</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      æ¸©æ•…è€ŒçŸ¥æ–°
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://tangyin1.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">çº¿ç¨‹æ± çš„ä¸€äº›ç›¸å…³çŸ¥è¯†</h2>
            <div class="post-date">2023-10-18</div>
            
              <div class="feature-container" style="background-image: url('https://tangyin1.github.io/post-images/xian-cheng-chi-de-yi-xie-xiang-guan-zhi-shi.png')">
              </div>
            
            <div class="post-content" v-pre>
              <p>ğŸ˜€ğŸ˜€ğŸ˜€æœ€è¿‘åœ¨bç«™ä¸Šåˆ·åˆ°ä¸€ä¸ªå…³äºçº¿ç¨‹æ± çš„è¯¾ç¨‹ï¼Œä»¥å‰å­¦osçš„æ—¶å€™ä¹Ÿæ²¡è®¤çœŸå­¦ä¹ ç›¸å…³ä»£ç çŸ¥è¯†ï¼Œåªæ˜¯äº†è§£ä¸€ä¸‹ç†è®ºçŸ¥è¯†ï¼ŒçŸ¥é“ä¸€äº›é˜»å¡ï¼Œç«äº‰ï¼Œæ—¶é—´ç‰‡è½®è½¬ç­‰ç­‰ä¸€äº›ï¼Œä»¥ä¸‹æ˜¯ç›¸å…³è§†é¢‘ä¸‹é¢è®°å¾—ç¬”è®°ã€‚<br>
ï¼ˆä¸è¿‡å­˜åœ¨ä¸€äº›é—®é¢˜è¿˜æ²¡æœ‰è§£å†³ï¼Œåœ¨æ‰‹å†™ä¸€ä¸ªçº¿ç¨‹æ± çš„é‚£é‡Œï¼Œæ²¡æœ‰æ­£ç¡®å†™å‡ºï¼Œç¼–è¯‘æ­£å¸¸ï¼Œä½†è¿è¡Œæ—¶ä¼šé˜»å¡å¡ä½ï¼Œä»¥åå­¦ä¹ ä¹‹åå†æ¥è§£å†³ï¼‰ğŸ˜€ğŸ˜€ğŸ˜€</p>
<!-- more -->
<h3 id="è¿›ç¨‹çš„æ¦‚å¿µ">è¿›ç¨‹çš„æ¦‚å¿µ</h3>
<p>è¿›ç¨‹å°±æ˜¯è¿è¡Œä¸­çš„ç¨‹åº</p>
<ul>
<li>
<p>çº¿ç¨‹å°±æ˜¯è¿›ç¨‹ä¸­çš„è¿›ç¨‹</p>
</li>
<li>
<p>çº¿ç¨‹çš„æœ€å¤§æ•°é‡å–å†³äºCPUçš„æ ¸å¿ƒæ•°ï¼Œæœ€å¤§çº¿ç¨‹æ•°å¹¶ä¸ç­‰äºcpuæ ¸æ•°ï¼Œä¸€ä¸ªæ ¸å¯ä»¥å¤šçº¿ç¨‹</p>
</li>
</ul>
<h3 id="join">join()</h3>
<ol>
<li>
<p>ä¸»ç¨‹åºç­‰å¾…çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼šjoin()</p>
</li>
<li>
<p>åˆ†ç¦»çº¿ç¨‹ï¼šdetach()</p>
</li>
<li>
<p>joinable():åˆ¤æ–­è¿›ç¨‹æ˜¯å¦å¯ä»¥ä½¿ç”¨joinå‡½æ•°ï¼Œå¯ä»¥åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›false</p>
</li>
</ol>
<p>â€‹    å¯èƒ½ä¼šå‡ºç°é˜»å¡çŠ¶æ€ï¼Œç„¶åjoinä¼šä½¿å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œä¸»çº¿ç¨‹æ‰ä¼šæ‰§è¡Œ</p>
<p>stdï¼šï¼šref  ä¼ é€’å¼•ç”¨ç±»å‹</p>
<h3 id="äº’æ–¥é‡è§£å†³å¤šçº¿ç¨‹æ•°æ®å…±äº«é—®é¢˜">äº’æ–¥é‡è§£å†³å¤šçº¿ç¨‹æ•°æ®å…±äº«é—®é¢˜</h3>
<ul>
<li>
<p>é€šè¿‡åŠ é”è§£é”çš„æ–¹å¼æ¥è§£å†³</p>
</li>
<li>
<p>åœ¨mutexå¤´æ–‡ä»¶ä¸­</p>
</li>
<li>
<p><font color='red'>lock()åŠ é”</font></p>
</li>
<li>
<p><font color='red'>unlock()è§£é” </font></p>
</li>
</ul>
<p><strong>å¦‚æœå¤šçº¿ç¨‹ç¨‹åºæ¯ä¸€æ¬¡è¿è¡Œçš„ç»“æœå’Œå•çº¿ç¨‹è¿è¡Œçš„ç»“æœå§‹ç»ˆæ˜¯<font color='red'>ä¸€æ ·çš„</font>ï¼Œé‚£ä¹ˆä½ çš„çº¿ç¨‹å°±æ˜¯<font color='red'>å®‰å…¨çš„</font></strong></p>
<h3 id="lock_guard-ä¸unique_lock">lock_guard ä¸unique_lock</h3>
<p>lock_guardï¼šäº’æ–¥é‡å°è£…ç±»ï¼Œç”¨äº<font color='red'>ä¿æŠ¤å…±äº«æ•°æ®</font>ï¼Œé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€èµ„æºè€Œå¯¼è‡´çš„æ•°æ®ç«äº‰é—®é¢˜</p>
<p>ç‰¹ç‚¹ï¼š</p>
<p>å½“ææ„å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œè¯¥äº’æ–¥é‡ä¼šè‡ªåŠ¨è§£é”</p>
<p>å¯¹è±¡ä¸èƒ½å¤åˆ¶æˆ–è€…ç§»åŠ¨ï¼Œå› æ­¤å®ƒåªèƒ½åœ¨å±€éƒ¨ä½œç”¨åŸŸä¸­ä½¿ç”¨</p>
<h3 id="stdunique_lock"><strong>std::unique_lock</strong></h3>
<p><code>std::unique_lock</code> æ˜¯ C++ æ ‡å‡†åº“ä¸­æä¾›çš„ä¸€ä¸ªäº’æ–¥é‡å°è£…ç±»ï¼Œç”¨äºåœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­å¯¹äº’æ–¥é‡è¿›è¡ŒåŠ é”å’Œè§£é”æ“ä½œã€‚å®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯å¯ä»¥å¯¹äº’æ–¥é‡è¿›è¡Œæ›´åŠ çµæ´»çš„ç®¡ç†ï¼ŒåŒ…æ‹¬å»¶è¿ŸåŠ é”ã€æ¡ä»¶å˜é‡ã€è¶…æ—¶ç­‰ã€‚<font color='red'>åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„å¾ˆé¢‘ç¹</font></p>
<p><code>std::unique_lock</code> æä¾›äº†ä»¥ä¸‹å‡ ä¸ªæˆå‘˜å‡½æ•°ï¼š</p>
<ul>
<li>
<p><code>lock()</code>ï¼šå°è¯•å¯¹äº’æ–¥é‡è¿›è¡ŒåŠ é”æ“ä½œï¼Œå¦‚æœå½“å‰äº’æ–¥é‡å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº’æ–¥é‡è¢«æˆåŠŸåŠ é”ã€‚</p>
</li>
<li>
<p><code>try_lock()</code>ï¼šå°è¯•å¯¹äº’æ–¥é‡è¿›è¡ŒåŠ é”æ“ä½œï¼Œå¦‚æœå½“å‰äº’æ–¥é‡å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™å‡½æ•°ç«‹å³è¿”å› <code>false</code>ï¼Œå¦åˆ™è¿”å› <code>true</code>ã€‚</p>
</li>
<li>
<p><code>try_lock_for(const std::chrono::duration&lt;Rep, Period&gt;&amp; rel_time)</code>ï¼šå°è¯•å¯¹äº’æ–¥é‡è¿›è¡ŒåŠ é”æ“ä½œï¼Œå¦‚æœå½“å‰äº’æ–¥é‡å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº’æ–¥é‡è¢«æˆåŠŸåŠ é”ï¼Œæˆ–è€…è¶…è¿‡äº†æŒ‡å®šçš„æ—¶é—´ã€‚</p>
</li>
<li>
<p><code>try_lock_until(const std::chrono::time_point&lt;Clock, Duration&gt;&amp; abs_time)</code>ï¼šå°è¯•å¯¹äº’æ–¥é‡è¿›è¡ŒåŠ é”æ“ä½œï¼Œå¦‚æœå½“å‰äº’æ–¥é‡å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº’æ–¥é‡è¢«æˆåŠŸåŠ é”ï¼Œæˆ–è€…è¶…è¿‡äº†æŒ‡å®šçš„æ—¶é—´ç‚¹ã€‚</p>
</li>
<li>
<p><code>unlock()</code>ï¼šå¯¹äº’æ–¥é‡è¿›è¡Œè§£é”æ“ä½œã€‚</p>
</li>
</ul>
<p>é™¤äº†ä¸Šè¿°æˆå‘˜å‡½æ•°å¤–ï¼Œ<code>std::unique_lock</code> è¿˜æä¾›äº†ä»¥ä¸‹å‡ ä¸ªæ„é€ å‡½æ•°ï¼š</p>
<ul>
<li><code>unique_lock() noexcept = default</code>ï¼šé»˜è®¤æ„é€ å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæœªå…³è”ä»»ä½•äº’æ–¥é‡çš„ <code>std::unique_lock</code> å¯¹è±¡ã€‚</li>
<li><code>explicit unique_lock(mutex_type&amp; m)</code>ï¼šæ„é€ å‡½æ•°ï¼Œä½¿ç”¨ç»™å®šçš„äº’æ–¥é‡ <code>m</code> è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶å¯¹è¯¥äº’æ–¥é‡è¿›è¡ŒåŠ é”æ“ä½œã€‚</li>
<li><code>unique_lock(mutex_type&amp; m, defer_lock_t) noexcept</code>ï¼šæ„é€ å‡½æ•°ï¼Œä½¿ç”¨ç»™å®šçš„äº’æ–¥é‡ <code>m</code> è¿›è¡Œåˆå§‹åŒ–ï¼Œä½†ä¸å¯¹è¯¥äº’æ–¥é‡è¿›è¡ŒåŠ é”æ“ä½œã€‚</li>
<li><code>unique_lock(mutex_type&amp; m, try_to_lock_t) noexcept</code>ï¼šæ„é€ å‡½æ•°ï¼Œä½¿ç”¨ç»™å®šçš„äº’æ–¥é‡ <code>m</code> è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶å°è¯•å¯¹è¯¥äº’æ–¥é‡è¿›è¡ŒåŠ é”æ“ä½œã€‚å¦‚æœåŠ é”å¤±è´¥ï¼Œåˆ™åˆ›å»ºçš„ <code>std::unique_lock</code> å¯¹è±¡ä¸ä¸ä»»ä½•äº’æ–¥é‡å…³è”ã€‚</li>
<li><code>unique_lock(mutex_type&amp; m, adopt_lock_t) noexcept</code>ï¼šæ„é€ å‡½æ•°ï¼Œä½¿ç”¨ç»™å®šçš„äº’æ–¥é‡ <code>m</code> è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶å‡è®¾è¯¥äº’æ–¥é‡å·²ç»è¢«å½“å‰çº¿ç¨‹æˆåŠŸåŠ é”ã€‚</li>
</ul>
<h3 id="call_onceä¸å…¶ä½¿ç”¨åœºæ™¯">call_onceä¸å…¶ä½¿ç”¨åœºæ™¯</h3>
<p>å•ä¾‹è®¾è®¡æ¨¡å¼æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œç”¨äºç¡®ä¿æŸä¸ªç±»åªèƒ½åˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚ç”±äºå•ä¾‹å®ä¾‹æ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œå› æ­¤åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨å•ä¾‹æ¨¡å¼æ—¶ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜</p>
<p>æ‡’æ±‰æ¨¡å¼ã€é¥¿æ±‰æ¨¡å¼</p>
<h3 id="å¼‚æ­¥å¹¶å‘">å¼‚æ­¥å¹¶å‘</h3>
<ul>
<li>
<p>asyncã€future</p>
<p>æ˜¯C++11å¼•å…¥çš„ä¸€ä¸ªå‡½æ•°æ¨¡æ¿ï¼Œç”¨äºå¼‚æ­¥æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªstd::futureå¯¹è±¡ï¼Œè¡¨ç¤ºå¼‚æ­¥æ“ä½œçš„ç»“æœã€‚ä½¿ç”¨std::asyncå¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œå¼‚æ­¥ç¼–ç¨‹ï¼Œ<font color='red'>é¿å…äº†æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹å’Œç®¡ç†çº¿ç¨‹çš„éº»çƒ¦ã€‚</font></p>
</li>
<li>
<p>packaged</p>
<p>åœ¨C++ä¸­ï¼Œpackaged_taskæ˜¯ä¸€ä¸ªç±»æ¨¡æ¿ï¼Œç”¨äºå°†ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼ˆå¦‚å‡½æ•°ã€å‡½æ•°å¯¹è±¡æˆ–Lambdaè¡¨è¾¾å¼ï¼‰å°è£…æˆä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œå¹¶è¿”å›ä¸€ä¸ªstd::futureå¯¹è±¡ï¼Œè¡¨ç¤ºå¼‚æ­¥æ“ä½œçš„ç»“æœã€‚packaged_taskå¯ä»¥æ–¹ä¾¿åœ°å°†ä¸€ä¸ªå‡½æ•°æˆ–å¯è°ƒç”¨å¯¹è±¡è½¬æ¢æˆä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œä¾›å…¶ä»–çº¿ç¨‹ä½¿ç”¨ã€‚</p>
</li>
</ul>
<pre><code class="language-c++">#include&lt;iostream&gt;
#include&lt;future&gt;
using namespace std;

int func()
{
	int a = 0;
	for (int i=0; i &lt; 1000; i++)
	{
		a++;

	}
	return a;

}

int main()
{
	//future&lt;int&gt; result = async(launch::async, func);
	packaged_task&lt;int()&gt;task(func);
	auto result = task.get_future();
	thread t1(move(task));
	cout &lt;&lt; func() &lt;&lt; endl;
	t1.join();
	cout &lt;&lt; result.get() &lt;&lt; endl;//éœ€è¦getæ‹¿åˆ°aï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œç±»ä¼¼è¿›ç¨‹ä¸­æ•°æ®ç«äº‰é—®é¢˜
	return 0;
}
</code></pre>
<ul>
<li>
<p><font color='red'>promise</font></p>
<p>åœ¨C++ä¸­ï¼Œpromiseæ˜¯ä¸€ä¸ªç±»æ¨¡æ¿ï¼Œç”¨äºåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­äº§ç”Ÿä¸€ä¸ªå€¼ï¼Œå¹¶åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­è·å–è¿™ä¸ªå€¼ã€‚promiseé€šå¸¸ä¸futureå’Œasyncä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºå®ç°å¼‚æ­¥ç¼–ç¨‹ã€‚å¯ä»¥åœ¨ä¸»çº¿ç¨‹ä¸­æ‹¿åˆ°å­çº¿ç¨‹ç”Ÿæˆçš„å€¼ã€‚</p>
</li>
</ul>
<pre><code class="language-c++">#include&lt;iostream&gt;
#include&lt;future&gt;
using namespace std;
void func(promise&lt;int&gt;&amp;f)
{
	f.set_value(100);
}
int main()
{
	promise&lt;int&gt;f;
	auto fu= f.get_future();
	thread t1(func, ref(f));
	t1.join();
	cout &lt;&lt; fu.get() &lt;&lt; endl;

	return 0;

}




</code></pre>
<h3 id="åŸå­å˜é‡">åŸå­å˜é‡</h3>
<h4 id="atomic">atomicï¼š</h4>
<p>æ˜¯ C++11 æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ¨¡æ¿ç±»ï¼Œç”¨äºå®ç°å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„åŸå­æ“ä½œã€‚å®ƒæä¾›äº†ä¸€ç§çº¿ç¨‹å®‰å…¨çš„æ–¹å¼æ¥è®¿é—®å’Œä¿®æ”¹å…±äº«å˜é‡ï¼Œå¯ä»¥é¿å…å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„æ•°æ®ç«äº‰é—®é¢˜ã€‚åŸå­åŠ é”æ¯”è‡ªå·±å»æ‰‹åŠ¨åŠ é”è§£é”çš„æ•ˆç‡æ˜¯æ›´é«˜çš„ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ <code>std::atomic</code> æ“ä½œï¼š</p>
<ol>
<li>
<p><code>load()</code>ï¼šå°† <code>std::atomic</code> å˜é‡çš„å€¼åŠ è½½åˆ°å½“å‰çº¿ç¨‹çš„æœ¬åœ°ç¼“å­˜ä¸­ï¼Œå¹¶è¿”å›è¿™ä¸ªå€¼ã€‚</p>
</li>
<li>
<p><code>store(val)</code>ï¼šå°† <code>val</code> çš„å€¼å­˜å‚¨åˆ° <code>std::atomic</code> å˜é‡ä¸­ï¼Œå¹¶ä¿è¯è¿™ä¸ªæ“ä½œæ˜¯åŸå­æ€§çš„ã€‚</p>
</li>
<li>
<p><code>exchange(val)</code>ï¼šå°† <code>val</code> çš„å€¼å­˜å‚¨åˆ° <code>std::atomic</code> å˜é‡ä¸­ï¼Œå¹¶è¿”å›åŸå…ˆçš„å€¼ã€‚</p>
</li>
<li>
<p><code>compare_exchange_weak(expected, val)</code> å’Œ <code>compare_exchange_strong(expected, val)</code>ï¼šæ¯”è¾ƒ <code>std::atomic</code> å˜é‡çš„å€¼å’Œ <code>expected</code> çš„å€¼æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒï¼Œåˆ™å°† <code>val</code> çš„å€¼å­˜å‚¨åˆ° <code>std::atomic</code> å˜é‡ä¸­ï¼Œå¹¶è¿”å› <code>true</code>ï¼›å¦åˆ™ï¼Œå°† <code>std::atomic</code> å˜é‡çš„å€¼å­˜å‚¨åˆ° <code>expected</code> ä¸­ï¼Œå¹¶è¿”å› <code>false</code>ã€‚</p>
</li>
</ol>
<p>ä»¥ä¸‹æ˜¯é‚£ä¸ªçº¿ç¨‹æ± çš„ä»£ç ï¼š</p>
<pre><code class="language-c++">#include&lt;iostream&gt;
#include&lt;thread&gt;
#include&lt;mutex&gt;
#include&lt;vector&gt;
#include&lt;queue&gt;
#include&lt;condition_variable&gt;
#include&lt;functional&gt;
class ThreadPool {
public:
	ThreadPool(int numThreads ):stop (false)
	{
		for (int i = 0; i &lt; numThreads; i++)
		{
			threads.emplace_back([this]
				{
					while (1)
					{
						std::unique_lock&lt;std::mutex&gt; lock(mtx);
						condition.wait(lock, [this] {
							return stop || !tasks.empty();
							});
						if (stop &amp;&amp; tasks.empty())
						{
							return;
						}
						std::function&lt;void()&gt;task(std::move(tasks.front()));
						tasks.pop();
						lock.unlock();
						task();
					}
				});
		}

	}

	~ThreadPool()
	{
		std::unique_lock&lt;std::mutex&gt; lock(mtx);
		stop = true;
		condition.notify_all();
		for(auto &amp;t:threads)
		{
			t.join();
		}
	}
	template&lt;class F, class... Args&gt;
	void enqueau(F &amp;&amp; f,Args&amp;&amp;... args)//ä¸‡èƒ½å¼•ç”¨
	{
		std::function&lt;void()&gt;task=
			std::bind(std::forward&lt;F&gt;(f),
			std::forward&lt;Args&gt;(args)...);//å®Œç¾è½¬æ¢
		
		{
			std::unique_lock&lt;std::mutex&gt; lock(mtx);
			tasks.emplace(std::move(task));
		}
		condition.notify_one();
	}
	
private:
	std::vector&lt;std::thread&gt; threads;
	std::queue&lt;std::function &lt;void()&gt;&gt; tasks;
	std::mutex mtx;
	std::condition_variable condition;
	bool stop;
};

int main()
{
	ThreadPool pool(2);

	for(int i=0;i&lt;4;i++)
	{ 
		pool.enqueau([i] {
			std::cout &lt;&lt; &quot;task : &quot; &lt;&lt; i &lt;&lt; &quot;is running&quot;  &lt;&lt; std::endl;
			std::this_thread::sleep_for(std::chrono::seconds(1));
			std::cout &lt;&lt; &quot;task : &quot; &lt;&lt; i &lt;&lt; &quot;is down&quot; &lt;&lt; std::endl;
			});
		
	}
	return 0;

}</code></pre>

            </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://tangyin1.github.io/post/guan-yu-docker-de-yi-xie-ji-chu-pu-ji/">
                  <h3 class="post-title">
                    å…³äºDockerçš„ä¸€äº›åŸºç¡€æ™®åŠ
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
